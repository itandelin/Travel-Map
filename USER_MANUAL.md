# WordPress Travel Map 插件用户手册

## 目录
1. [插件简介](#插件简介)
2. [快速开始](#快速开始)
3. [基础配置](#基础配置)
4. [标记管理](#标记管理)
5. [短代码使用](#短代码使用)
6. [文章集成](#文章集成)
7. [高级功能](#高级功能)
8. [常见问题](#常见问题)
9. [故障排除](#故障排除)

## 插件简介

WordPress Travel Map 是一个专为旅行博主设计的地图插件，基于高德地图API提供交互式地图展示功能。插件支持三种旅行状态管理，可以与WordPress文章系统深度集成，为您的旅行博客增添生动的地图展示效果。

### 主要特性
- 🗺️ **交互式地图**: 基于高德地图的响应式地图展示
- 📍 **三种状态**: 已去、想去、计划三种旅行状态管理
- 📝 **文章集成**: 与WordPress文章系统深度集成
- 🎨 **自定义样式**: 丰富的样式和主题选项
- 📱 **移动友好**: 完美适配移动端设备
- 🔧 **易于使用**: 简单的短代码和直观的管理界面

## 快速开始

### 第一步：获取高德地图API密钥

1. 访问 [高德开放平台](https://lbs.amap.com/)
2. 注册并登录账号
3. 创建新应用，选择"Web端(JS API)"
4. 获取API Key

### 第二步：配置插件

1. 在WordPress管理后台，进入 **旅行地图 > 设置**
2. 在"高德地图API密钥"字段中输入您的API Key
3. 配置其他基础设置（可选）
4. 点击"保存设置"

### 第三步：添加第一个标记

1. 进入 **旅行地图 > 坐标管理**
2. 点击"添加新坐标"
3. 在地图上点击选择位置，或手动输入坐标
4. 填写地点名称和描述
5. 选择旅行状态（已去/想去/计划）
6. 保存标记

### 第四步：在页面中显示地图

在任意页面或文章中插入短代码：
```
[travel_map]
```

## 基础配置

### 设置页面详解

进入 **旅行地图 > 设置** 可以配置以下选项：

#### API配置
- **高德地图API密钥**: 必填项，用于加载地图服务
- **默认地图中心**: 设置地图的默认中心点坐标
- **默认缩放级别**: 设置地图的默认缩放级别（1-18）

#### 显示设置
- **默认地图宽度**: 设置地图容器的默认宽度
- **默认地图高度**: 设置地图容器的默认高度
- **启用标记聚合**: 当标记点较多时自动聚合显示
- **显示筛选标签**: 是否显示状态筛选标签

#### 颜色设置
- **已去标记颜色**: 自定义已去状态的标记颜色（默认橙色）
- **想去标记颜色**: 自定义想去状态的标记颜色（默认蓝色）
- **计划标记颜色**: 自定义计划状态的标记颜色（默认绿色）

#### 权限设置
- **允许编辑的用户角色**: 设置哪些用户角色可以管理标记
- **公开显示**: 是否允许未登录用户查看地图

## 标记管理

### 添加标记

#### 方法一：通过坐标管理页面
1. 进入 **旅行地图 > 坐标管理**
2. 点击"添加新坐标"
3. 使用以下方式之一设置位置：
   - 在地图上直接点击
   - 手动输入经纬度坐标
   - 搜索地点名称（自动获取坐标）

#### 方法二：通过文章编辑页面
1. 编辑任意文章或页面
2. 在编辑器下方找到"旅行地图坐标"Meta Box
3. 设置坐标信息并保存文章

### 标记字段说明

- **地点名称**: 标记点的显示名称（必填）
- **经度/纬度**: 地理坐标（必填）
- **旅行状态**: 选择已去/想去/计划
- **访问日期**: 记录访问或计划访问的日期
- **描述**: 详细的地点描述或旅行感受
- **自定义颜色**: 覆盖默认的状态颜色
- **优先级**: 影响标记的显示顺序（0-10）
- **公开状态**: 是否公开显示此标记

### 批量操作

#### 导入数据
支持以下格式的数据导入：
- **CSV格式**: 包含坐标、名称、状态等字段
- **GPX格式**: GPS轨迹文件导入
- **JSON格式**: 结构化数据导入

导入步骤：
1. 进入 **旅行地图 > 导入导出**
2. 选择文件格式和上传文件
3. 映射字段对应关系
4. 预览并确认导入

#### 导出数据
1. 进入 **旅行地图 > 导入导出**
2. 选择导出格式（CSV/JSON/GPX）
3. 设置筛选条件（可选）
4. 下载导出文件

#### 批量编辑
1. 在坐标管理页面选择多个标记
2. 选择"批量操作"
3. 可以批量修改状态、颜色、公开性等属性

## 短代码使用

### 基础短代码

最简单的使用方式：
```
[travel_map]
```

### 模板用法说明（主题/小工具）

如果短代码不是放在文章/页面正文里，而是放在主题模板或小工具中，建议在渲染短代码前显式加载资源，以确保样式与脚本可用：

```
<?php
if (function_exists('travel_map_enqueue_assets')) {
    travel_map_enqueue_assets();
}
?>
```

然后输出短代码即可：

```
<?php echo do_shortcode('[travel_map]'); ?>
```

### 完整参数列表

```
[travel_map 
    width="100%" 
    height="500px" 
    zoom="4" 
    center="35.0,105.0" 
    status="all" 
    filter_tabs="true" 
    clustering="true" 
    popup_style="default" 
    marker_style="default" 
    theme="default"
]
```

### 参数详解

#### 尺寸参数
- `width`: 地图宽度，支持像素值(px)和百分比(%)
- `height`: 地图高度，支持像素值(px)和百分比(%)

#### 地图参数
- `zoom`: 缩放级别，范围1-18，数值越大越详细
- `center`: 地图中心点，格式为"纬度,经度"

#### 数据筛选
- `status`: 显示的标记状态
  - `all`: 显示所有状态（默认）
  - `visited`: 只显示已去的地点
  - `want_to_go`: 只显示想去的地点
  - `planned`: 只显示计划的地点
  - `visited,want_to_go`: 显示多个状态（用逗号分隔）

#### 功能开关
- `filter_tabs`: 是否显示筛选标签（true/false）
- `clustering`: 是否启用标记聚合（true/false）

#### 样式设置
- `popup_style`: 弹窗样式
  - `default`: 默认样式
  - `minimal`: 简约样式
  - `card`: 卡片样式
- `marker_style`: 标记样式
  - `default`: 默认圆形标记
  - `pin`: 图钉样式
  - `custom`: 自定义样式
- `theme`: 地图主题
  - `default`: 默认主题
  - `dark`: 深色主题
  - `light`: 浅色主题
  - `satellite`: 卫星图

### 使用示例

#### 示例1：显示特定区域的已去地点
```
[travel_map width="800px" height="400px" zoom="6" center="39.9042,116.4074" status="visited"]
```

#### 示例2：深色主题的想去清单
```
[travel_map height="600px" status="want_to_go" theme="dark" popup_style="card"]
```

#### 示例3：移动端优化的全屏地图
```
[travel_map width="100%" height="70vh" clustering="false" filter_tabs="true"]
```

## 文章集成

### Meta Box使用

在文章编辑页面，您会看到"旅行地图坐标"Meta Box，包含以下功能：

#### 坐标设置
1. **地图选择**: 在小地图上点击设置坐标
2. **手动输入**: 直接输入经纬度数值
3. **地址搜索**: 输入地址自动获取坐标

#### 关联设置
- **地点名称**: 默认使用文章标题，可自定义
- **旅行状态**: 选择此地点的旅行状态
- **访问日期**: 设置访问或计划访问日期
- **描述**: 默认使用文章摘要，可自定义

#### 自动识别功能

插件可以自动识别文章内容中的地名：
1. 编辑文章时，插件会扫描内容
2. 识别出的地名会在Meta Box中显示
3. 点击地名可自动设置坐标

支持识别的地名类型：
- 中国主要城市和景点
- 国际知名城市
- 著名旅游景点
- 地标建筑

### 文章与标记的关联

#### 一对一关联
- 一篇文章对应一个地点标记
- 文章坐标信息自动同步到标记
- 标记弹窗中显示文章链接和摘要

#### 一对多关联
- 一篇文章可以关联多个标记点
- 适用于多地点的旅行文章
- 在Meta Box中可以添加多个坐标点

#### 多对一关联
- 多篇文章可以关联同一个标记点
- 标记弹窗中显示所有相关文章
- 适用于多次访问同一地点的情况

### 显示效果

当标记与文章关联后，地图上的效果：
- 标记点显示文章标题
- 点击标记显示文章摘要
- 弹窗中包含"阅读全文"链接
- 显示文章发布日期和作者

## 高级功能

### 自定义样式

#### CSS自定义
可以通过CSS自定义地图的外观：

```css
/* 自定义标记样式 */
.travel-marker {
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

/* 自定义弹窗样式 */
.travel-popup {
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* 自定义筛选标签 */
.travel-filter-tabs {
    background: #f8f9fa;
    border-radius: 6px;
    padding: 4px;
}
```

#### JavaScript扩展
可以通过JavaScript扩展地图功能：

```javascript
// 监听地图事件
document.addEventListener('travel_map_loaded', function(e) {
    const mapInstance = e.detail.map;
    // 自定义地图行为
});

// 自定义标记点击事件
document.addEventListener('travel_marker_click', function(e) {
    const markerData = e.detail.data;
    // 自定义处理逻辑
});
```

### 数据统计

#### 统计面板
在 **旅行地图 > 统计** 页面可以查看：
- 总标记数量
- 各状态标记分布
- 月度新增趋势
- 热门地点排行
- 用户活跃度

#### 导出报告
- 生成PDF格式的旅行报告
- 包含地图截图和统计数据
- 支持自定义报告模板

### 多用户支持

#### 权限管理
- **管理员**: 可以管理所有用户的标记
- **编辑者**: 可以管理自己和下级用户的标记
- **作者**: 只能管理自己的标记
- **订阅者**: 只能查看公开的标记

#### 用户隔离
- 每个用户只能看到自己的标记管理界面
- 前端地图可以显示所有公开标记
- 支持按用户筛选显示

### API接口

插件提供REST API接口供第三方调用：

#### 获取标记列表
```
GET /wp-json/travel-map/v1/markers
```

#### 添加标记
```
POST /wp-json/travel-map/v1/markers
```

#### 更新标记
```
PUT /wp-json/travel-map/v1/markers/{id}
```

#### 删除标记
```
DELETE /wp-json/travel-map/v1/markers/{id}
```

## 常见问题

### Q: 地图无法显示怎么办？
A: 请检查以下几点：
1. 确认已正确配置高德地图API密钥
2. 检查API密钥是否有效且未超出配额
3. 确认网站域名已添加到高德控制台的白名单
4. 检查浏览器控制台是否有JavaScript错误

### Q: 如何更改标记的默认颜色？
A: 有两种方式：
1. 在 **旅行地图 > 设置** 中修改全局默认颜色
2. 在编辑单个标记时设置自定义颜色

### Q: 可以导入Google Maps的数据吗？
A: 目前不直接支持，但可以：
1. 从Google Maps导出KML格式
2. 使用在线工具转换为CSV格式
3. 通过插件的CSV导入功能导入数据

### Q: 地图在移动端显示异常？
A: 请确认：
1. 使用响应式的宽度设置（如100%）
2. 高度设置合适的值（建议300px以上）
3. 主题CSS没有冲突

### Q: 如何备份地图数据？
A: 可以通过以下方式：
1. 使用插件的导出功能导出CSV或JSON文件
2. 通过WordPress数据库备份工具备份相关表
3. 使用WordPress完整备份插件

### Q: 标记点太多时地图很卡怎么办？
A: 建议：
1. 启用标记聚合功能
2. 使用状态筛选减少显示的标记数量
3. 考虑分页显示或按区域分组

## 故障排除

### 常见错误及解决方案

#### 错误1: "API密钥无效"
**原因**: API密钥配置错误或已失效
**解决方案**:
1. 检查API密钥是否正确复制
2. 确认API密钥类型为"Web端(JS API)"
3. 检查API密钥是否已启用相关服务

#### 错误2: "地图加载失败"
**原因**: 网络连接问题或API服务异常
**解决方案**:
1. 检查网络连接是否正常
2. 尝试刷新页面
3. 检查高德地图服务状态

#### 错误3: "标记无法保存"
**原因**: 数据验证失败或权限不足
**解决方案**:
1. 检查必填字段是否完整
2. 确认坐标格式是否正确
3. 检查用户权限设置

#### 错误4: "短代码不显示"
**原因**: 短代码参数错误或主题冲突
**解决方案**:
1. 检查短代码语法是否正确
2. 尝试使用最简单的短代码 `[travel_map]`
3. 检查主题是否支持短代码

### 调试模式

启用调试模式可以获得更详细的错误信息：

1. 在 `wp-config.php` 中添加：
```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
```

2. 在插件设置中启用"调试模式"

3. 查看 `/wp-content/debug.log` 文件获取详细错误信息

### 性能优化建议

1. **合理设置缓存**:
   - 启用WordPress对象缓存
   - 使用CDN加速静态资源

2. **优化标记数量**:
   - 启用标记聚合功能
   - 使用状态筛选减少显示数量

3. **图片优化**:
   - 压缩自定义标记图标
   - 使用WebP格式图片

4. **数据库优化**:
   - 定期清理无用数据
   - 优化数据库表结构

## 技术支持

如果您在使用过程中遇到问题，可以通过以下方式获得帮助：

1. **查看文档**: 仔细阅读本用户手册和技术文档
2. **检查FAQ**: 查看常见问题解答
3. **社区支持**: 在WordPress插件页面提交问题
4. **技术支持**: 联系插件开发团队

---

**用户手册版本**: 1.0  
**适用插件版本**: 1.0.0+  
**最后更新**: 2025年9月27日  
**文档维护**: Mr. T

希望这份详细的用户手册能帮助您充分利用WordPress Travel Map插件的所有功能，创建出色的旅行地图展示效果！
